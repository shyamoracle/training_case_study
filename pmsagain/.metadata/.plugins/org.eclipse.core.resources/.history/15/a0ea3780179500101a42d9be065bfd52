package com.oracle.pmsitis.test;

import com.oracle.pmsitis.repository.utilities.DaoUtility;
import org.junit.jupiter.api.Test;
import java.sql.Connection;
import java.util.Properties;
import static org.junit.jupiter.api.Assertions.*;

public class DaoUtilityTest {
    @Test
    void testDatabasePropertiesLoaded() {
        Properties props = DaoUtility.class.getDeclaredField("DB_SETTINGS").get(null);
        assertNotNull(props.getProperty("driver"));
        assertNotNull(props.getProperty("url"));
        assertNotNull(props.getProperty("username"));
        assertNotNull(props.getProperty("password"));
    }

    @Test
    void testCreateConnectionSuccess() throws Exception {
        Connection conn = DaoUtility.createConnection();
        assertNotNull(conn);
        conn.close();
    }

    @Test
    void testCreateConnectionFailure() {
        // Simulate missing property by temporarily removing url
        Properties props = DaoUtility.class.getDeclaredField("DB_SETTINGS").get(null);
        String oldUrl = props.getProperty("url");
        props.remove("url");
        Exception ex = assertThrows(Exception.class, DaoUtility::createConnection);
        assertTrue(ex.getMessage().contains("connection string not found"));
        props.setProperty("url", oldUrl); // restore
    }
}
